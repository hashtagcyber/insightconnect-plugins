import komand
from .schema import UpdateVulnerabilityExceptionStatusInput, UpdateVulnerabilityExceptionStatusOutput, Input, Output, Component
# Custom imports below
from komand_rapid7_insightvm.util import endpoints
from komand_rapid7_insightvm.util.resource_helper import ResourceHelper

class UpdateVulnerabilityExceptionStatus(komand.Action):

    def __init__(self):
        super(self.__class__, self).__init__(
                name='update_vulnerability_exception_status',
                description=Component.DESCRIPTION,
                input=UpdateVulnerabilityExceptionStatusInput(),
                output=UpdateVulnerabilityExceptionStatusOutput())

    def run(self, params={}):
        exception_id = params.get(Input.ID)
        status = params.get(Input.STATUS)

        resource_helper = ResourceHelper(self.connection.session, self.logger)
        endpoint = endpoints.VulnerabilityException.vulnerability_exception_status(self.connection.console_url,
                                                                                   exception_id,
                                                                                   status)

        resource_helper.resource_request(endpoint, method='post')

        return {Output.SUCCESS: True}
